sudo: required

env: TEST_ENV=INTEGRATION

services:
  - docker

addons:
  apt:
    packages:
    - mysql-server-5.6
    - mysql-client-core-5.6
    - mysql-client-5.6

before_install:
  - mysqladmin -u root password testDirac

# command to install dependencies
install:
  - docker pull ilcdirac/slc6-base

# command to run tests
script:
  - export PYTHONPATH=${PWD%/*}
  - ls $PYTHONPATH
  - export HOSTIP=`ip route show 0.0.0.0/0 | grep -Eo 'via \S+' | awk '{ print \$2 }'`
  - echo $HOSTIP
  - docker run -d -i -t --add-host=mysqlmachine:$HOSTIP -h localhost -v ${PWD}:/root/TestCode/DIRAC ilcdirac/slc6-base /bin/bash
  - export CONTAINER=`sudo docker ps -q`
  - docker exec $CONTAINER /bin/bash -c "cd && source TestCode/DIRAC/tests/Jenkins/setup_travis.sh && source TestCode/DIRAC/tests/Jenkins/dirac_ci.sh && fullInstallDIRAC"

